<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Poxi哥的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Poxi哥的博客">
<meta property="og:url" content="http://blog.ouronghui.com/index.html">
<meta property="og:site_name" content="Poxi哥的博客">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Poxi哥的博客">
  
    <link rel="alternate" href="/atom.xml" title="Poxi哥的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Poxi哥的博客</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">种一棵树最好的时间是十年前，其次是现在。</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.ouronghui.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Cassandra-数据库使用小记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/31/Cassandra-数据库使用小记/" class="article-date">
  <time datetime="2018-08-31T03:17:00.000Z" itemprop="datePublished">2018-08-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/数据库/">数据库</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/31/Cassandra-数据库使用小记/">Cassandra 数据库使用小记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Cassandra-数据库使用小记"><a href="#Cassandra-数据库使用小记" class="headerlink" title="Cassandra 数据库使用小记"></a>Cassandra 数据库使用小记</h1><h2 id="一、安装与配置"><a href="#一、安装与配置" class="headerlink" title="一、安装与配置"></a>一、安装与配置</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> cassadra</span></span><br><span class="line">wget http://mirrors.shu.edu.cn/apache/cassandra/3.11.3/apache-cassandra-3.11.3-bin.tar.gz</span><br><span class="line">tar -zxvf apache-cassandra-3.11.3-bin.tar.gz -C /usr/local/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 建立软链，方便升级</span></span><br><span class="line">cd /usr/local/</span><br><span class="line">ln -s apache-cassandra-3.11.3 cassandra	</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加到环境变量</span></span><br><span class="line">cat &lt;&lt; EOF &gt;&gt; /etc/profile</span><br><span class="line">export PATH=/usr/local/cassandra/bin:\$PATH</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">source /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改配置，方便内网连接</span></span><br><span class="line">vim /usr/local/cassandra/conf/cassandra.yaml</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> cluster_name: <span class="string">'Kong-dev-cluster'</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">          - seeds: <span class="string">"172.18.1.16"</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> listen_address: 172.18.1.16</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> rpc_address: 172.18.1.16</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 建立 cassandra 用户（cassandra建议非root用户运行）</span></span><br><span class="line">groupadd cassandra</span><br><span class="line">useradd -g cassandra cassandra</span><br><span class="line">chown -R cassandra:cassandra /usr/local/cassandra/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动 （默认非 daemon 模式，可配置人 supervisor）</span></span><br><span class="line">cassandra -f</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> or 配置 supervisor</span></span><br><span class="line">cat &lt;&lt; EOF &gt; /usr/local/deploy/supervisord/conf/cassandra.conf</span><br><span class="line">[program:cassandra]</span><br><span class="line">user=cassandra</span><br><span class="line">command=cassandra -f</span><br><span class="line">autostart=false</span><br><span class="line">autorestart=unexpected</span><br><span class="line">stdout_logfile=/usr/local/deploy/log/cassandra.log</span><br><span class="line">stderr_logfile=/usr/local/deploy/log/cassandra.err</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<h2 id="二、命令行使用"><a href="#二、命令行使用" class="headerlink" title="二、命令行使用"></a>二、命令行使用</h2><p>技巧：<code>cqlsh</code> 提供的命令行是具有智能提示的，输入命令的部分字母，按<code>Tab</code>建可以出发，再<code>CREATE KEYSPACE</code> 这条命令中可以深切的感受到方便。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cqlsh 172.18.10.217</span><br><span class="line">cqlsh&gt; show version;</span><br><span class="line">cqlsh&gt; show host;</span><br><span class="line">cqlsh&gt; desc cluster;</span><br><span class="line">cqlsh&gt; desc keyspaces;</span><br><span class="line">cqlsh&gt; CREATE KEYSPACE test_keyspace WITH replication = &#123;'class': 'SimpleStrategy', 'replication_factor': 1&#125;;</span><br><span class="line"><span class="comment">--（实际输入：C&lt;Tab&gt; k&lt;Tab&gt; test_keyspace w&lt;Tab&gt; s&lt;Tab&gt; &lt;Tab&gt; 1&#125;;）</span></span><br><span class="line">cqlsh&gt; desc keyspace test_keyspace;</span><br><span class="line">cqlsh&gt; use test_keyspace;</span><br><span class="line">cqlsh:test_keyspace&gt; desc tables;</span><br><span class="line">cqlsh:test_keyspace&gt; create table abc ( id int primary key, name varchar, age int );</span><br><span class="line">cqlsh:test_keyspace&gt; desc table abc;</span><br><span class="line">cqlsh:test_keyspace&gt; DROP TABLE abc ; -- abc 只输入 a， &lt;Tab&gt; 也可以自动补全哦</span><br><span class="line">cqlsh:test_keyspace&gt; drop KEYSPACE test_keyspace ;</span><br></pre></td></tr></table></figure>
<p>更多命令请参考 <a href="https://cassandra.apache.org/doc/latest/tools/cqlsh.html" target="_blank" rel="noopener">官方文档</a></p>
<h2 id="三、数据类型-附"><a href="#三、数据类型-附" class="headerlink" title="三、数据类型(附)"></a>三、数据类型(附)</h2><table>
<thead>
<tr>
<th>CQL类型</th>
<th>对应Java类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>ascii</td>
<td>String</td>
<td>ascii字符串</td>
</tr>
<tr>
<td>bigint</td>
<td>long</td>
<td>64位整数</td>
</tr>
<tr>
<td>blob</td>
<td>ByteBuffer/byte[]</td>
<td>二进制数组</td>
</tr>
<tr>
<td>boolean</td>
<td>boolean</td>
<td>布尔</td>
</tr>
<tr>
<td>counter</td>
<td>long</td>
<td>计数器，支持原子性的增减，不支持直接赋值</td>
</tr>
<tr>
<td>decimal</td>
<td>BigDecimal</td>
<td>高精度小数</td>
</tr>
<tr>
<td>double</td>
<td>double</td>
<td>64位浮点数</td>
</tr>
<tr>
<td>float</td>
<td>float</td>
<td>32位浮点数</td>
</tr>
<tr>
<td>inet</td>
<td>InetAddress</td>
<td>ipv4或ipv6协议的ip地址</td>
</tr>
<tr>
<td>int</td>
<td>int</td>
<td>32位整数</td>
</tr>
<tr>
<td>list</td>
<td>List</td>
<td>有序的列表</td>
</tr>
<tr>
<td>map</td>
<td>Map</td>
<td>键值对</td>
</tr>
<tr>
<td>set</td>
<td>Set</td>
<td>集合</td>
</tr>
<tr>
<td>text</td>
<td>String</td>
<td><a href="http://zh.wikipedia.org/w/index.php?title=Utf-8&amp;action=edit&amp;redlink=1" target="_blank" rel="noopener">utf-8编码的字符串</a></td>
</tr>
<tr>
<td>timestamp</td>
<td>Date</td>
<td>日期</td>
</tr>
<tr>
<td>uuid</td>
<td>UUID</td>
<td><a href="http://zh.wikipedia.org/wiki/UUID" target="_blank" rel="noopener">UUID类型</a></td>
</tr>
<tr>
<td>timeuuid</td>
<td>UUID</td>
<td>时间相关的UUID</td>
</tr>
<tr>
<td>varchar</td>
<td>string</td>
<td>text的别名</td>
</tr>
<tr>
<td>varint</td>
<td>BigInteger</td>
<td>高精度整型</td>
</tr>
</tbody>
</table>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ouronghui.com/2018/08/31/Cassandra-数据库使用小记/" data-id="cjoqlefg90031vyrjjms9ualv" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cassandra/">cassandra</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Supervisor的使用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/22/Supervisor的使用/" class="article-date">
  <time datetime="2018-08-22T01:24:00.000Z" itemprop="datePublished">2018-08-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/22/Supervisor的使用/">Supervisor的使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="supervisor"><a href="#supervisor" class="headerlink" title="supervisor"></a>supervisor</h1><p>Supervisord 是用 Python 实现的一款非常实用的进程管理工具，supervisord 还要求管理的程序是非 daemon 程序，supervisord 会帮你把它转成 daemon 程序，因此如果用 supervisord 来管理 nginx 的话，必须在 nginx 的配置文件里添加一行设置 daemon off 让 nginx 以非 daemon 方式启动。</p>
<h4 id="1-安装-与-默认配置"><a href="#1-安装-与-默认配置" class="headerlink" title="1. 安装 与 默认配置"></a>1. 安装 与 默认配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">apt-cache search python-setuptools</span><br><span class="line">sudo apt-get install python-setuptools</span><br><span class="line">easy_install supervisor</span><br><span class="line">supervisord -v</span><br><span class="line">echo_supervisord_conf &gt; /etc/supervisord.conf # 默认的配置 输入 /etc/supvervisord.conf</span><br></pre></td></tr></table></figure>
<p>修改为自己习惯的配置 <code>/etc/supvervisord.conf</code>:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[unix_http_server]          ; supervisord的unix socket服务配置</span><br><span class="line">file=/usr/local/deploy/supervisord/supervisor.sock   ; socket文件的保存目录</span><br><span class="line"></span><br><span class="line">[inet_http_server]         ; supervisord的tcp服务配置</span><br><span class="line">port=*:9001         ; tcp端口</span><br><span class="line"></span><br><span class="line">[supervisord]                ; supervisord的主进程配置</span><br><span class="line">logfile=/usr/local/deploy/supervisord/supervisord.log ; 主要的进程日志配置</span><br><span class="line">logfile_maxbytes=50MB        ; 最大日志体积，默认50MB</span><br><span class="line">logfile_backups=10           ; 日志文件备份数目，默认10</span><br><span class="line">loglevel=info                ; 日志级别，默认info; 还有:debug,warn,trace</span><br><span class="line">pidfile=/usr/local/deploy/supervisord/supervisord.pid ; supervisord的pidfile文件</span><br><span class="line">nodaemon=false               ; 是否以守护进程的方式启动</span><br><span class="line">minfds=1024                  ; 最小的有效文件描述符，默认1024</span><br><span class="line">minprocs=200                 ; 最小的有效进程描述符，默认200</span><br><span class="line"></span><br><span class="line">[rpcinterface:supervisor]</span><br><span class="line">supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface</span><br><span class="line"></span><br><span class="line">[supervisorctl]</span><br><span class="line">serverurl=unix:///usr/local/deploy/supervisord/supervisor.sock ; use a unix:// URL  for a unix socket</span><br><span class="line"></span><br><span class="line">[include]</span><br><span class="line">files = /usr/local/deploy/supervisord/conf/*.conf</span><br></pre></td></tr></table></figure></p>
<h4 id="2-加载自定义配置目录-vim-etc-supervisord-conf"><a href="#2-加载自定义配置目录-vim-etc-supervisord-conf" class="headerlink" title="2. 加载自定义配置目录 vim /etc/supervisord.conf"></a>2. 加载自定义配置目录 <code>vim /etc/supervisord.conf</code></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /usr/local/deploy/supervisord/conf/</span><br><span class="line"></span><br><span class="line">;...</span><br><span class="line">[include]</span><br><span class="line">files = /usr/local/deploy/supervisord/conf/*.conf</span><br></pre></td></tr></table></figure>
<h4 id="3-新建管理的应用"><a href="#3-新建管理的应用" class="headerlink" title="3. 新建管理的应用"></a>3. 新建管理的应用</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/deploy/supervisord/conf/</span><br><span class="line">vim express-service.conf</span><br></pre></td></tr></table></figure>
<p>内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[program:express-service]</span><br><span class="line">command=node /home/vagrant/test-service/app.js</span><br><span class="line">autostart=false</span><br><span class="line">autorestart=false</span><br><span class="line">stdout_logfile=/usr/local/deploy/log/express-service.out</span><br><span class="line">stderr_logfile=/usr/local/deploy/log/express-service.err</span><br></pre></td></tr></table></figure></p>
<p>如果报错，可以使用<strong> <code>supervisorctl tail express-service stdout</code></strong> 来查看具体报错。</p>
<p>另外配置文件可使用：<code>%(directory)</code> 的格式来引用变量。</p>
<h4 id="常见问题："><a href="#常见问题：" class="headerlink" title="常见问题："></a>常见问题：</h4><ol>
<li>直接访问<code>http://127.0.0.1:9001/</code> 可以查看 <code>Tail -f</code>的日志，通过Nginx代理后则不行；Nginx需要增加以下配置，参考<a href="https://serverfault.com/questions/568317/supervisord-inet-http-server-behind-nginx/836855#836855?newreg=7574ede0fbb34cd9af55679f542abb96" target="_blank" rel="noopener">Supervisord inet_http_server behind nginx</a>：<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">  <span class="attribute">listen</span> <span class="number">9000</span>;</span><br><span class="line">  <span class="attribute">listen</span> [::]:<span class="number">9000</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">server_name</span> server.gmetri.com;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">location</span> / &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://127.0.0.1:9001;</span><br><span class="line">    <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">    <span class="attribute">proxy_buffering</span>     <span class="literal">off</span>;</span><br><span class="line">    <span class="attribute">proxy_max_temp_file_size</span> <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">proxy_redirect</span>     default;</span><br><span class="line">    <span class="attribute">proxy_set_header</span>   Host             <span class="variable">$host</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span>   X-Real-IP        <span class="variable">$remote_addr</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span>   X-Forwarded-For  <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span>   Connection       <span class="string">""</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="supervisord-管理"><a href="#supervisord-管理" class="headerlink" title="supervisord 管理"></a>supervisord 管理</h4><p>启动：<code>supervisord</code> (默认会读<code>/etc/supervisord.conf</code>)或者 指定主配置<code>supervisord -c /etc/supervisord.conf</code> </p>
<ul>
<li>supervisorctl 不跟其他，进入 supervisorctl console, status 可以查看所有任务的状态，uptime等，新增任务需要 update</li>
<li>supervisorctl update，根据最新的配置文件，启动新配置或有改动的进程，配置没有改动的进程不会受影响而重启。</li>
<li>supervisorctl reload，载入最新的配置文件，停止原有进程并按新的配置启动、管理所有进程。</li>
<li>supervisorctl stop xxx 停止某一个进程</li>
</ul>
<h4 id="附-task-配置-Demo"><a href="#附-task-配置-Demo" class="headerlink" title="附 task 配置 Demo"></a>附 task 配置 Demo</h4><p><code>auth-service.conf</code>:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[program:auth-service]</span><br><span class="line">command=java -D&quot;app.id=gateway&quot; -D&quot;env=FAT&quot; -javaagent:/usr/local/skywalking-agent/skywalking-agent.jar -jar /usr/local/deploy/auth-service-exec.jar</span><br><span class="line">autostart=false</span><br><span class="line">autorestart=false</span><br><span class="line">stdout_logfile=/usr/local/deploy/log/auth-service.out</span><br><span class="line">stderr_logfile=/usr/local/deploy/log/auth-service.err</span><br></pre></td></tr></table></figure></p>
<p><code>shadowsocks.conf</code>:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[program:shadowsocks]</span><br><span class="line">command=sslocal -c ~/shadowsocks.json</span><br><span class="line">autostart=true</span><br><span class="line">autorestart=true</span><br><span class="line">user=nobody</span><br></pre></td></tr></table></figure></p>
<h4 id="附-program-配置"><a href="#附-program-配置" class="headerlink" title="附 program 配置"></a>附 program 配置</h4><p><a href="http://www.supervisord.org/configuration.html#program-x-section-example" target="_blank" rel="noopener">http://www.supervisord.org/configuration.html#program-x-section-example</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[program:cat]</span><br><span class="line">command=/bin/cat</span><br><span class="line">process_name=%(program_name)s</span><br><span class="line">numprocs=1</span><br><span class="line">directory=/tmp</span><br><span class="line">umask=022</span><br><span class="line">priority=999</span><br><span class="line">autostart=true</span><br><span class="line">autorestart=unexpected</span><br><span class="line">startsecs=10</span><br><span class="line">startretries=3</span><br><span class="line">exitcodes=0,2</span><br><span class="line">stopsignal=TERM</span><br><span class="line">stopwaitsecs=10</span><br><span class="line">stopasgroup=false</span><br><span class="line">killasgroup=false</span><br><span class="line">user=chrism</span><br><span class="line">redirect_stderr=false</span><br><span class="line">stdout_logfile=/a/path</span><br><span class="line">stdout_logfile_maxbytes=1MB</span><br><span class="line">stdout_logfile_backups=10</span><br><span class="line">stdout_capture_maxbytes=1MB</span><br><span class="line">stdout_events_enabled=false</span><br><span class="line">stderr_logfile=/a/path</span><br><span class="line">stderr_logfile_maxbytes=1MB</span><br><span class="line">stderr_logfile_backups=10</span><br><span class="line">stderr_capture_maxbytes=1MB</span><br><span class="line">stderr_events_enabled=false</span><br><span class="line">environment=A=&quot;1&quot;,B=&quot;2&quot;</span><br><span class="line">serverurl=AUTO</span><br></pre></td></tr></table></figure></p>
<h4 id="附-supervisor-配置说明："><a href="#附-supervisor-配置说明：" class="headerlink" title="附 supervisor 配置说明："></a>附 supervisor 配置说明：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line">; Sample supervisor config file.</span><br><span class="line">;</span><br><span class="line">; For more information on the config file, please see:</span><br><span class="line">; http://supervisord.org/configuration.html</span><br><span class="line">;</span><br><span class="line">; Note: shell expansion (&quot;~&quot; or &quot;$HOME&quot;) is not supported.  Environment</span><br><span class="line">; variables can be expanded using this syntax: &quot;%(ENV_HOME)s&quot;.</span><br><span class="line"></span><br><span class="line">[unix_http_server]          ; supervisord的unix socket服务配置</span><br><span class="line">file=/tmp/supervisor.sock   ; socket文件的保存目录</span><br><span class="line">;chmod=0700                 ; socket的文件权限 (default 0700)</span><br><span class="line">;chown=nobody:nogroup       ; socket的拥有者和组名</span><br><span class="line">;username=user              ; 默认不需要登陆用户 (open server)</span><br><span class="line">;password=123               ; 默认不需要登陆密码 (open server)</span><br><span class="line"></span><br><span class="line">;[inet_http_server]         ; supervisord的tcp服务配置</span><br><span class="line">;port=127.0.0.1:9001        ; tcp端口</span><br><span class="line">;username=user              ; tcp登陆用户</span><br><span class="line">;password=123               ; tcp登陆密码</span><br><span class="line"></span><br><span class="line">[supervisord]                ; supervisord的主进程配置</span><br><span class="line">logfile=/tmp/supervisord.log ; 主要的进程日志配置</span><br><span class="line">logfile_maxbytes=50MB        ; 最大日志体积，默认50MB</span><br><span class="line">logfile_backups=10           ; 日志文件备份数目，默认10</span><br><span class="line">loglevel=info                ; 日志级别，默认info; 还有:debug,warn,trace</span><br><span class="line">pidfile=/tmp/supervisord.pid ; supervisord的pidfile文件</span><br><span class="line">nodaemon=false               ; 是否以守护进程的方式启动</span><br><span class="line">minfds=1024                  ; 最小的有效文件描述符，默认1024</span><br><span class="line">minprocs=200                 ; 最小的有效进程描述符，默认200</span><br><span class="line">;umask=022                   ; 进程文件的umask，默认200</span><br><span class="line">;user=chrism                 ; 默认为当前用户，如果为root则必填</span><br><span class="line">;identifier=supervisor       ; supervisord的表示符, 默认时&apos;supervisor&apos;</span><br><span class="line">;directory=/tmp              ; 默认不cd到当前目录</span><br><span class="line">;nocleanup=true              ; 不在启动的时候清除临时文件，默认false</span><br><span class="line">;childlogdir=/tmp            ; (&apos;AUTO&apos; child log dir, default $TEMP)</span><br><span class="line">;environment=KEY=value       ; 初始键值对传递给进程</span><br><span class="line">;strip_ansi=false            ; (strip ansi escape codes in logs; def. false)</span><br><span class="line"></span><br><span class="line">; the below section must remain in the config file for RPC</span><br><span class="line">; (supervisorctl/web interface) to work, additional interfaces may be</span><br><span class="line">; added by defining them in separate rpcinterface: sections</span><br><span class="line">[rpcinterface:supervisor]</span><br><span class="line">supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface</span><br><span class="line"></span><br><span class="line">[supervisorctl]</span><br><span class="line">serverurl=unix:///tmp/supervisor.sock ; use a unix:// URL  for a unix socket</span><br><span class="line">;serverurl=http://127.0.0.1:9001 ; use an http:// url to specify an inet socket</span><br><span class="line">;username=chris              ; 如果设置应该与http_username相同</span><br><span class="line">;password=123                ; 如果设置应该与http_password相同</span><br><span class="line">;prompt=mysupervisor         ; 命令行提示符，默认&quot;supervisor&quot;</span><br><span class="line">;history_file=~/.sc_history  ; 命令行历史纪录</span><br><span class="line"></span><br><span class="line">; The below sample program section shows all possible program subsection values,</span><br><span class="line">; create one or more &apos;real&apos; program: sections to be able to control them under</span><br><span class="line">; supervisor.</span><br><span class="line"></span><br><span class="line">;[program:theprogramname]</span><br><span class="line">;command=/bin/cat              ; 运行的程序 (相对使用PATH路径, 可以使用参数)</span><br><span class="line">;process_name=%(program_name)s ; 进程名表达式，默认为%(program_name)s</span><br><span class="line">;numprocs=1                    ; 默认启动的进程数目，默认为1</span><br><span class="line">;directory=/tmp                ; 在运行前cwd到指定的目录，默认不执行cmd</span><br><span class="line">;umask=022                     ; 进程umask，默认None</span><br><span class="line">;priority=999                  ; 程序运行的优先级，默认999</span><br><span class="line">;autostart=true                ; 默认随supervisord自动启动，默认true</span><br><span class="line">;autorestart=unexpected        ; whether/when to restart (default: unexpected)</span><br><span class="line">;startsecs=1                   ; number of secs prog must stay running (def. 1)</span><br><span class="line">;startretries=3                ; max # of serial start failures (default 3)</span><br><span class="line">;exitcodes=0,2                 ; 期望的退出码，默认0,2</span><br><span class="line">;stopsignal=QUIT               ; 杀死进程的信号，默认TERM</span><br><span class="line">;stopwaitsecs=10               ; max num secs to wait b4 SIGKILL (default 10)</span><br><span class="line">;stopasgroup=false             ; 向unix进程组发送停止信号，默认false</span><br><span class="line">;killasgroup=false             ; 向unix进程组发送SIGKILL信号，默认false</span><br><span class="line">;user=chrism                   ; 为运行程序的unix帐号设置setuid</span><br><span class="line">;redirect_stderr=true          ; 将标准错误重定向到标准输出，默认false</span><br><span class="line">;stdout_logfile=/a/path        ; 标准输出的文件路径NONE＝none;默认AUTO</span><br><span class="line">;stdout_logfile_maxbytes=1MB   ; max # logfile bytes b4 rotation (default 50MB)</span><br><span class="line">;stdout_logfile_backups=10     ; # of stdout logfile backups (default 10)</span><br><span class="line">;stdout_capture_maxbytes=1MB   ; number of bytes in &apos;capturemode&apos; (default 0)</span><br><span class="line">;stdout_events_enabled=false   ; emit events on stdout writes (default false)</span><br><span class="line">;stderr_logfile=/a/path        ; stderr log path, NONE for none; default AUTO</span><br><span class="line">;stderr_logfile_maxbytes=1MB   ; max # logfile bytes b4 rotation (default 50MB)</span><br><span class="line">;stderr_logfile_backups=10     ; # of stderr logfile backups (default 10)</span><br><span class="line">;stderr_capture_maxbytes=1MB   ; number of bytes in &apos;capturemode&apos; (default 0)</span><br><span class="line">;stderr_events_enabled=false   ; emit events on stderr writes (default false)</span><br><span class="line">;environment=A=1,B=2           ; process environment additions (def no adds)</span><br><span class="line">;serverurl=AUTO                ; override serverurl computation (childutils)</span><br><span class="line"></span><br><span class="line">; The below sample eventlistener section shows all possible</span><br><span class="line">; eventlistener subsection values, create one or more &apos;real&apos;</span><br><span class="line">; eventlistener: sections to be able to handle event notifications</span><br><span class="line">; sent by supervisor.</span><br><span class="line"></span><br><span class="line">;[eventlistener:theeventlistenername]</span><br><span class="line">;command=/bin/eventlistener    ; 运行的程序 (相对使用PATH路径, 可以使用参数)</span><br><span class="line">;process_name=%(program_name)s ; 进程名表达式，默认为%(program_name)s</span><br><span class="line">;numprocs=1                    ; 默认启动的进程数目，默认为1</span><br><span class="line">;events=EVENT                  ; event notif. types to subscribe to (req&apos;d)</span><br><span class="line">;buffer_size=10                ; 事件缓冲区队列大小，默认10</span><br><span class="line">;directory=/tmp                ; 在运行前cwd到指定的目录，默认不执行cmd</span><br><span class="line">;umask=022                     ; 进程umask，默认None</span><br><span class="line">;priority=-1                   ; 程序运行的优先级，默认-1</span><br><span class="line">;autostart=true                ; 默认随supervisord自动启动，默认true</span><br><span class="line">;autorestart=unexpected        ; whether/when to restart (default: unexpected)</span><br><span class="line">;startsecs=1                   ; number of secs prog must stay running (def. 1)</span><br><span class="line">;startretries=3                ; max # of serial start failures (default 3)</span><br><span class="line">;exitcodes=0,2                 ; 期望的退出码，默认0,2</span><br><span class="line">;stopsignal=QUIT               ; 杀死进程的信号，默认TERM</span><br><span class="line">;stopwaitsecs=10               ; max num secs to wait b4 SIGKILL (default 10)</span><br><span class="line">;stopasgroup=false             ; 向unix进程组发送停止信号，默认false</span><br><span class="line">;killasgroup=false             ; 向unix进程组发送SIGKILL信号，默认false</span><br><span class="line">;user=chrism                   ; setuid to this UNIX account to run the program</span><br><span class="line">;redirect_stderr=true          ; redirect proc stderr to stdout (default false)</span><br><span class="line">;stdout_logfile=/a/path        ; stdout log path, NONE for none; default AUTO</span><br><span class="line">;stdout_logfile_maxbytes=1MB   ; max # logfile bytes b4 rotation (default 50MB)</span><br><span class="line">;stdout_logfile_backups=10     ; # of stdout logfile backups (default 10)</span><br><span class="line">;stdout_events_enabled=false   ; emit events on stdout writes (default false)</span><br><span class="line">;stderr_logfile=/a/path        ; stderr log path, NONE for none; default AUTO</span><br><span class="line">;stderr_logfile_maxbytes=1MB   ; max # logfile bytes b4 rotation (default 50MB)</span><br><span class="line">;stderr_logfile_backups        ; # of stderr logfile backups (default 10)</span><br><span class="line">;stderr_events_enabled=false   ; emit events on stderr writes (default false)</span><br><span class="line">;environment=A=1,B=2           ; process environment additions</span><br><span class="line">;serverurl=AUTO                ; override serverurl computation (childutils)</span><br><span class="line"></span><br><span class="line">; The below sample group section shows all possible group values,</span><br><span class="line">; create one or more &apos;real&apos; group: sections to create &quot;heterogeneous&quot;</span><br><span class="line">; process groups.</span><br><span class="line"></span><br><span class="line">;[group:thegroupname]</span><br><span class="line">;programs=progname1,progname2  ; 任何在[program:x]中定义的x</span><br><span class="line">;priority=999                  ; 程序运行的优先级，默认999</span><br><span class="line"></span><br><span class="line">; The [include] section can just contain the &quot;files&quot; setting.  This</span><br><span class="line">; setting can list multiple files (separated by whitespace or</span><br><span class="line">; newlines).  It can also contain wildcards.  The filenames are</span><br><span class="line">; interpreted as relative to this file.  Included files *cannot*</span><br><span class="line">; include files themselves.</span><br><span class="line"></span><br><span class="line">;[include]</span><br><span class="line">;files = relative/directory/*.ini</span><br><span class="line"></span><br><span class="line">作者：BlackRun</span><br><span class="line">链接：https://www.jianshu.com/p/5c3922fa97c0</span><br><span class="line">來源：简书</span><br><span class="line">简书著作权归作者所有，任何形式的转载都请联系作者获得授权并注明出处。</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ouronghui.com/2018/08/22/Supervisor的使用/" data-id="cjoqlefgl003pvyrjm9m1207x" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/服务/">服务</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/进程/">进程</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Lua-OpenResty-开发环境搭建" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/09/Lua-OpenResty-开发环境搭建/" class="article-date">
  <time datetime="2018-08-09T02:13:00.000Z" itemprop="datePublished">2018-08-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Nginx/">Nginx</a>►<a class="article-category-link" href="/categories/Nginx/Openresty/">Openresty</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/09/Lua-OpenResty-开发环境搭建/">Lua OpenResty 开发环境搭建</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-创建目录-usr-servers，以后我们把所有软件安装在此目录"><a href="#1-创建目录-usr-servers，以后我们把所有软件安装在此目录" class="headerlink" title="1. 创建目录/usr/servers，以后我们把所有软件安装在此目录"></a>1. 创建目录/usr/servers，以后我们把所有软件安装在此目录</h2> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /usr/servers</span><br><span class="line">cd /usr/servers/</span><br><span class="line">ls</span><br></pre></td></tr></table></figure>
<h2 id="2-下载openresty-1-13-6-2-tar-gz并解压"><a href="#2-下载openresty-1-13-6-2-tar-gz并解压" class="headerlink" title="2.下载openresty-1.13.6.2.tar.gz并解压"></a>2.下载openresty-1.13.6.2.tar.gz并解压</h2> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://openresty.org/download/openresty-1.13.6.2.tar.gz</span><br><span class="line">tar -zxvf openresty-1.13.6.2.tar.gz</span><br><span class="line">cd openresty-1.13.6.2/bundle/</span><br></pre></td></tr></table></figure>
<h2 id="3-安装LuaJIT"><a href="#3-安装LuaJIT" class="headerlink" title="3. 安装LuaJIT"></a>3. 安装LuaJIT</h2> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd LuaJIT-2.1-20180420/</span><br><span class="line">ls</span><br><span class="line">make clean &amp;&amp; make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<h2 id="4-下载ngx-cache-purge模块，该模块用于清理nginx缓存"><a href="#4-下载ngx-cache-purge模块，该模块用于清理nginx缓存" class="headerlink" title="4. 下载ngx_cache_purge模块，该模块用于清理nginx缓存"></a>4. 下载ngx_cache_purge模块，该模块用于清理nginx缓存</h2> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/servers/openresty-1.13.6.2/bundle/</span><br><span class="line">wget https://github.com/FRiCKLE/ngx_cache_purge/archive/2.3.tar.gz</span><br><span class="line">tar -xvf 2.3.tar.gz</span><br></pre></td></tr></table></figure>
<h2 id="5-下载nginx-upstream-check-module模块，该模块用于ustream健康检查"><a href="#5-下载nginx-upstream-check-module模块，该模块用于ustream健康检查" class="headerlink" title="5. 下载nginx_upstream_check_module模块，该模块用于ustream健康检查"></a>5. 下载nginx_upstream_check_module模块，该模块用于ustream健康检查</h2> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/servers/ngx_openresty-1.7.7.2/bundle</span><br><span class="line">cd /usr/servers/openresty-1.13.6.2/bundle/</span><br><span class="line">wget https://github.com/yaoweibin/nginx_upstream_check_module/archive/v0.3.0.tar.gz</span><br><span class="line">tar -xvf v0.3.0.tar.gz</span><br></pre></td></tr></table></figure>
<h2 id="6-安装-openresty"><a href="#6-安装-openresty" class="headerlink" title="6. 安装 openresty"></a>6. 安装 openresty</h2> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install openssl-devel pcre-devel zlib-devel -y</span><br><span class="line">cd /usr/servers/openresty-1.13.6.2/</span><br><span class="line">./configure --prefix=/usr/servers --with-http_realip_module  --with-pcre  --with-luajit --add-module=./bundle/ngx_cache_purge-2.3/ --add-module=./bundle/nginx_upstream_check_module-0.3.0/ -j2</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<h2 id="7-目录说明"><a href="#7-目录说明" class="headerlink" title="7. 目录说明"></a>7. 目录说明</h2><p> <code>/usr/servers/luajit</code> ：luajit环境，luajit类似于java的jit，即即时编译，lua是一种解释语言，通过luajit可以即时编译lua代码到机器代码，得到很好的性能；<br> <code>/usr/servers/lualib</code>：要使用的lua库，里边提供了一些默认的lua库，如redis，json库等，也可以把一些自己开发的或第三方的放在这；<br> <code>/usr/servers/nginx</code> ：安装的nginx；</p>
<h2 id="8-启动nginx"><a href="#8-启动nginx" class="headerlink" title="8. 启动nginx"></a>8. 启动nginx</h2><p> <code>/usr/servers/nginx/sbin/nginx</code></p>
<h2 id="9-配置环境"><a href="#9-配置环境" class="headerlink" title="9. 配置环境"></a>9. 配置环境</h2><ol>
<li>编辑nginx.conf配置文件<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/servers/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol start="2">
<li>在http部分添加如下配置<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#lua模块路径，多个之间”;”分隔，其中”;;”表示默认搜索路径，默认到/usr/servers/nginx下找</span><br><span class="line">lua_package_path &quot;/usr/servers/lualib/?.lua;;&quot;; #lua 模块</span><br><span class="line">lua_package_cpath &quot;/usr/servers/lualib/?.so;;&quot;; #c模块</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol start="3">
<li>为了方便开发我们在/usr/servers/nginx/conf目录下创建一个lua.conf<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#lua.conf</span><br><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  server_name _;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol start="4">
<li>在nginx.conf中的http部分添加include lua.conf包含此文件片段<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include lua.conf;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol start="5">
<li>测试是否正常<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/servers/nginx/sbin/nginx -t</span><br></pre></td></tr></table></figure></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ouronghui.com/2018/08/09/Lua-OpenResty-开发环境搭建/" data-id="cjoqlefgd0038vyrjawex2onl" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Nginx/">Nginx</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Nginx-Lua-实现灰度发布" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/05/Nginx-Lua-实现灰度发布/" class="article-date">
  <time datetime="2018-08-05T04:48:00.000Z" itemprop="datePublished">2018-08-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Nginx/">Nginx</a>►<a class="article-category-link" href="/categories/Nginx/Lua/">Lua</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/05/Nginx-Lua-实现灰度发布/">Nginx+Lua 实现灰度发布</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一、安装Lua环境及相关库"><a href="#一、安装Lua环境及相关库" class="headerlink" title="一、安装Lua环境及相关库"></a>一、安装Lua环境及相关库</h2><h3 id="1-LuaJIT"><a href="#1-LuaJIT" class="headerlink" title="1. LuaJIT"></a>1. LuaJIT</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget http://luajit.org/download/LuaJIT-2.0.5.tar.gz</span><br><span class="line">tar -zxvf LuaJIT-2.0.5.tar.gz -C /usr/<span class="built_in">local</span>/src/</span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src/LuaJIT-2.0.5/</span><br><span class="line">make install PREFIX=/usr/<span class="built_in">local</span>/LuaJIT</span><br><span class="line"><span class="built_in">export</span> LUAJIT_LIB=/usr/<span class="built_in">local</span>/LuaJIT/lib</span><br><span class="line"><span class="built_in">export</span> LUAJIT_INC=/usr/<span class="built_in">local</span>/LuaJIT/include/luajit-2.0</span><br></pre></td></tr></table></figure>
<h3 id="2-ngx-devel-kit和lua-nginx-module"><a href="#2-ngx-devel-kit和lua-nginx-module" class="headerlink" title="2. ngx_devel_kit和lua-nginx-module"></a>2. ngx_devel_kit和lua-nginx-module</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/simplresty/ngx_devel_kit/archive/v0.3.1rc1.tar.gz</span><br><span class="line">wget https://github.com/openresty/lua-nginx-module/archive/v0.10.13.tar.gz</span><br><span class="line">tar -zxvf v0.3.1rc1.tar.gz -C /usr/<span class="built_in">local</span>/src/</span><br><span class="line">tar -zxvf v0.10.13.tar.gz -C /usr/<span class="built_in">local</span>/src/</span><br></pre></td></tr></table></figure>
<h3 id="3-编译Nginx"><a href="#3-编译Nginx" class="headerlink" title="3. 编译Nginx"></a>3. 编译Nginx</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget http://nginx.org/download/nginx-1.15.2.tar.gz</span><br><span class="line">tar -zxvf nginx-1.15.2.tar.gz -C /usr/<span class="built_in">local</span>/src/</span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src/nginx-1.15.2/</span><br><span class="line"><span class="comment"># 以下编译选项，除后两个，其余其实就是yum安装ngnix下nginx -V的默认编译选项</span></span><br><span class="line">./configure --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib64/nginx/modules --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/<span class="built_in">log</span>/nginx/error.log --http-log-path=/var/<span class="built_in">log</span>/nginx/access.log --pid-path=/var/run/nginx.pid --lock-path=/var/run/nginx.lock --http-client-body-temp-path=/var/cache/nginx/client_temp --http-proxy-temp-path=/var/cache/nginx/proxy_temp --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp --http-scgi-temp-path=/var/cache/nginx/scgi_temp --user=nginx --group=nginx --with-compat --with-file-aio --with-threads --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_mp4_module --with-http_random_index_module --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-mail --with-mail_ssl_module --with-stream --with-stream_realip_module --with-stream_ssl_module --with-stream_ssl_preread_module --with-cc-opt=<span class="string">'-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -m64 -mtune=generic -fPIC'</span> --with-ld-opt=<span class="string">'-Wl,-z,relro -Wl,-z,now -pie'</span> --add-module=/usr/<span class="built_in">local</span>/src/ngx_devel_kit-0.3.1rc1 --add-module=/usr/<span class="built_in">local</span>/src/lua-nginx-module-0.10.13</span><br><span class="line">make -j 4 &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<h3 id="4-加载lua库，加入到ld-so-conf文件"><a href="#4-加载lua库，加入到ld-so-conf文件" class="headerlink" title="4. 加载lua库，加入到ld.so.conf文件"></a>4. 加载lua库，加入到ld.so.conf文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;/usr/local/LuaJIT/lib&quot; &gt;&gt; /etc/ld.so.conf</span><br><span class="line">ldconfig</span><br></pre></td></tr></table></figure>
<h2 id="二、灰度实现"><a href="#二、灰度实现" class="headerlink" title="二、灰度实现"></a>二、灰度实现</h2><h3 id="1-灰度目标"><a href="#1-灰度目标" class="headerlink" title="1. 灰度目标"></a>1. 灰度目标</h3><p>当客户端ip为<code>192.168.56.1</code>时，让其访问新发布的upstream测试实例；其他ip访问时还是老的upstream实例。相当于前者为新发布功能，后者为稳定的生产功能。</p>
<h3 id="2-灰度准备"><a href="#2-灰度准备" class="headerlink" title="2. 灰度准备"></a>2. 灰度准备</h3><ol>
<li><p>这里使用 <code>memcache</code> 来存储哪些ip要访问新的，哪些ip访问稳定的老的。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">yum install memcached </span><br><span class="line">memcached -p11211 -u nobody -d</span><br><span class="line"><span class="comment"># 设置 灰度ip</span></span><br><span class="line">telnet 127.0.0.1 11211</span><br><span class="line"><span class="built_in">set</span> 192.168.56.1 0 0 1</span><br><span class="line">1</span><br><span class="line">get 192.168.56.1</span><br><span class="line"><span class="comment"># 安装lua-resty-memcached</span></span><br><span class="line">wget https://github.com/openresty/lua-resty-memcached/archive/v0.14.tar.gz</span><br><span class="line">tar -zxvf v0.14.tar.gz -C /usr/<span class="built_in">local</span>/src/</span><br><span class="line">cp -r /usr/<span class="built_in">local</span>/src/lua-resty-memcached-0.14/lib/resty /usr/<span class="built_in">local</span>/LuaJIT/share/luajit-2.0.5/</span><br></pre></td></tr></table></figure>
</li>
<li><p>准备两个服务<code>新上线服务</code> 与 <code>稳定生产服务</code>,这里使用两个tomcat来演示(如果你熟悉node 也可以使用node快速实现两个后台服务)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#测试页面</span></span><br><span class="line">vim test.jsp</span><br><span class="line"> 1 &lt;%@ page language=<span class="string">"java"</span> import=<span class="string">"java.util.*"</span> pageEncoding=<span class="string">"utf-8"</span> %&gt;</span><br><span class="line">  2 &lt;!DOCTYPE html&gt;</span><br><span class="line">  3 &lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">  4 &lt;head&gt;</span><br><span class="line">  5 |   &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">  6 |   &lt;title&gt;Test Jsp&lt;/title&gt;</span><br><span class="line">  7 &lt;/head&gt;</span><br><span class="line">  8 &lt;body&gt;</span><br><span class="line">  9 |   &lt;%</span><br><span class="line"> 10 |   |   Random rand = new Random();</span><br><span class="line"> 11 |   |   out.println(<span class="string">"&lt;h1&gt;Test server&lt;/h1&gt;"</span>);</span><br><span class="line"> 12 |   |   out.println(<span class="string">"&lt;h1&gt;Random number:&lt;/h1&gt;"</span>);</span><br><span class="line"> 13 |   |   out.println(rand.nextInt(99) + 100);</span><br><span class="line"> 14 |   %&gt;</span><br><span class="line"> 15 &lt;/body&gt;</span><br><span class="line"> 16 &lt;/html&gt; </span><br><span class="line"><span class="comment"># 两个tomcat: tomcat8080, tomcat9090，前者作为新上线服务，后者作为 稳定的生产服务；将上面的test.jsp页面分别放置到两个tomcat的ROOT下；tomcat9090 删除test.jsp中的11行，以示区别。</span></span><br><span class="line"><span class="comment"># 分别启动两个tomcat</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置Nginx nginx.conf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">|   location / &#123; </span><br><span class="line">|   |   default_type &apos;text/html&apos;;</span><br><span class="line">|   |   content_by_lua_file /opt/app/lua/dep.lua;</span><br><span class="line">|   &#125;</span><br><span class="line">|   location @server&#123;</span><br><span class="line">|   |   proxy_pass http://127.0.0.1:9090;</span><br><span class="line">|   &#125;</span><br><span class="line">|   location @server_test&#123;</span><br><span class="line">|   |   proxy_pass http://127.0.0.1:8080;</span><br><span class="line">|   &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写 <code>/opt/app/lua/dep.lua</code></p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> clientIP = ngx.req.get_headers()[<span class="string">"X-Real-IP"</span>]</span><br><span class="line"><span class="keyword">if</span> clientIP == <span class="literal">nil</span> <span class="keyword">then</span></span><br><span class="line">|   clientIP = ngx.req.get_headers()[<span class="string">"x_forwarded_for"</span>]</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">if</span> clientIP == <span class="literal">nil</span> <span class="keyword">then</span></span><br><span class="line">|   clientIP = ngx.var.remote_addr</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">local</span> memcached = <span class="built_in">require</span> <span class="string">"resty.memcached"</span></span><br><span class="line"><span class="keyword">local</span> memc, err = memcached:new()</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> memc <span class="keyword">then</span></span><br><span class="line">|   ngx.say(<span class="string">"failed to instance memc:"</span>, err)</span><br><span class="line">|   <span class="keyword">return</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">local</span> ok, err = memc:connect(<span class="string">"127.0.0.1"</span>, <span class="number">11211</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> ok <span class="keyword">then</span></span><br><span class="line">|   ngx.say(<span class="string">"failed to connect: "</span>, err)</span><br><span class="line">|   <span class="keyword">return</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">local</span> res, flags, err = memc:get(clientIP)</span><br><span class="line"><span class="comment">--ngx.say("value key: ", res, clientIP)</span></span><br><span class="line"><span class="keyword">if</span> err <span class="keyword">then</span></span><br><span class="line">|   ngx.say(<span class="string">"failed to get clientIP "</span>, err)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">if</span> res == <span class="string">"1"</span> <span class="keyword">then</span></span><br><span class="line">|   ngx.exec(<span class="string">"@server_test"</span>)</span><br><span class="line">|   <span class="keyword">return</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">ngx.exec(<span class="string">"@server"</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动Nginx，访问测试</p>
</li>
</ol>
<p>在本机使用 <code>curl http://127.0.0.1/test.jsp</code> 查看效果，返回结果<strong>无 Test server 字样</strong>。</p>
<p>在<code>192.168.56.1</code> 访问 <code>http://192.168.56.101</code>（此ip为Nginx 服务所在ip） 查看效果，返回结果<strong>有 Test server 字样</strong>。</p>
<h3 id="三、小结"><a href="#三、小结" class="headerlink" title="三、小结"></a>三、小结</h3><p>以上只是简单的针对某个 <code>ip</code> 做的灰度，完整的灰度，还需要企业后台灵活的管理<code>memcache</code>。</p>
<p>另外要实现更灵活的灰度，比如根据 Cookie, header 头信息，也可以个根据这种原理来实现。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ouronghui.com/2018/08/05/Nginx-Lua-实现灰度发布/" data-id="cjoqlefgf003cvyrjdzzu0wwl" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/灰度发布/">灰度发布</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-大白话简记TCP" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/22/大白话简记TCP/" class="article-date">
  <time datetime="2018-07-22T06:53:53.000Z" itemprop="datePublished">2018-07-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/计算机基础/">计算机基础</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/22/大白话简记TCP/">大白话简记TCP</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="ISO-定的-OSI-七层模型"><a href="#ISO-定的-OSI-七层模型" class="headerlink" title="ISO 定的 OSI 七层模型"></a>ISO 定的 OSI 七层模型</h4><h4 id="协议族五层"><a href="#协议族五层" class="headerlink" title="协议族五层"></a>协议族五层</h4><h4 id="TCP-生命周期"><a href="#TCP-生命周期" class="headerlink" title="TCP 生命周期"></a>TCP 生命周期</h4><p><img src="http://wx3.sinaimg.cn/mw690/929194b4gy1ffpbganvcij20ob0r40ut.jpg" alt="tcp连接生命周期"></p>
<ul>
<li><p><strong>对于建链接的3次握手</strong> 主要是初始化<code>Sequence Number</code>的初始值。通信的双方要互相知道对方初始化的<code>Sequence Number</code>(缩写<code>ISN</code>: <code>Initial Sequence Number</code>)，所以叫<code>SYN</code>,全称：Synchronize Sequence Number。这个同步序号作为此TCP连接后面数据通信的序号，以保证应用层能处理乱序、重复、丢失的问题。</p>
</li>
<li><p><strong>对于4次挥手</strong> 其实你仔细看是2次，因为TCP是全双工的，所以双方都会发出<code>FIN</code>、<code>ACK</code>一次请求和应答。只不过有一方是被动的，所以看上去就像是4次挥手。如果两边同时发出断开的请求，那就会进入到<code>CLOSING</code>的状态，然后到达<code>TIME_WAIT</code>状态。下图是双方同时段连接的示意图：</p>
</li>
</ul>
<p><img src="http://wx1.sinaimg.cn/mw690/929194b4gy1ffpc8nbexoj20ii0emjs4.jpg" alt="同时发起断开请求"></p>
<p>因为双方同时发起了<code>FIN</code>，都认为自己是<code>FIN发起的主动方</code>，各自都进入<code>FIN_WAIT_1</code>状态，都在等待对方<code>被动</code>发出<code>FIN</code>请求，同时双方都收到对方的<code>FIN</code>请求，于是各自应答对方<code>ACK</code>，对方进入<code>CLOSING</code>状态，这个<code>CLOSING</code>都是在等待前面提到<code>等待对方发出被动的FIN请求</code>，都在互相等待，那就像<code>死锁</code>了，这里的解决方案就是进入<code>CLOSING</code>状态时同时开启<code>TIME_WAIT</code>等待指定的时机后会自动进入<code>CLOSED</code>状态。</p>
<p>下面我们用<code>电话通话</code>的例子来比拟下这里的建立连接3次握手，断开链接4次挥手。</p>
<h5 id="打电话的3次握手"><a href="#打电话的3次握手" class="headerlink" title="打电话的3次握手"></a>打电话的3次握手</h5><blockquote>
<p>A: 你听到我说话么？                  – 1. 发往<code>B</code>的一个握手请求。发出问题让对方回答，目的是为了验证自己说的话对方能听到，即验证<code>自己的话筒</code> -&gt; <code>对方的听筒</code>这条链路。</p>
</blockquote>
<blockquote>
<p>B: 我听到你说话，你能听到我说话吗？    –2. 发往<code>A</code>的一个握手请求。回答对方的问题，让对方知道他的验证通过。自己再发出问题，目的是为了验证自己说的话对方能听到，也就是：<code>B的话筒</code> -&gt; <code>A的听筒</code>这条链路是通的。</p>
</blockquote>
<blockquote>
<p>A: 我也能听到你说话                  – 3. 发往<code>B</code>的一个握手请求。回答<code>B</code>的问题，让<code>B</code>知道他说的话自己也能听到。</p>
</blockquote>
<h5 id="4次挥手挂电话"><a href="#4次挥手挂电话" class="headerlink" title="4次挥手挂电话"></a>4次挥手挂电话</h5><blockquote>
<p>A: 我的话说完了，要挂电话了，你说完了么？ (发起断开 <code>A -&gt; B</code> 的请求)</p>
</blockquote>
<blockquote>
<p>B: 好吧（应答下对方的挂掉意思本方已经收到, 这里意味着 <code>A -&gt; B</code> 不会再发起新的请求，只有应答）</p>
</blockquote>
<blockquote>
<p>….</p>
</blockquote>
<blockquote>
<p>B: 我也说完了，我也要挂电话了 （发起断开 <code>B -&gt; A</code>链路的请求）</p>
</blockquote>
<blockquote>
<p>A: 好的 （应答对方，意味<code>B -&gt; A</code>的链路也断开了，整个连接完整断开）</p>
</blockquote>
<p>这里要解释的一点是，上面<code>B</code>的连在一起的两句话，为什么不能像建立连接时候的两句话再一次请求里一次说掉呢？ 因为<code>bye bye</code>前可能还有话正在说，而<code>hello</code>是对话的开始，之前没有别的话。</p>
<h4 id="几个需要注意的事情"><a href="#几个需要注意的事情" class="headerlink" title="几个需要注意的事情"></a>几个需要注意的事情</h4><ul>
<li><p><strong>关于建连接SYN超时</strong> 试想一下，如果<code>server</code>接到了<code>client</code>的<code>SYN</code>请求，然后应答了<code>ACK-SYN</code>后<code>client</code>掉线，<code>server</code>端没有收到<code>client</code>回来的<code>ACK</code>，那么连接处于一个中间的状态，既没成功，也没失败。于是<code>server</code>端如果在一定时间内没有收到<code>ACK</code>,<code>TCP</code>回重发<code>ACK-SYN</code>。在<code>Linux</code>下，默认重试次数是5次，5次重试的时间间隔分别是：<code>1s, 2s, 4s, 8s, 16s, 32s</code>,所以总共需要<code>1s+2s+4s+8s+16s+32s = 2^6 -1 = 63s</code>，<code>TCP</code>才会断开这个连接</p>
</li>
<li><p><strong>关于SYN Flood攻击</strong> 一些恶意的人就为此制造了<code>SYN Flood</code>攻击——给服务器发了一个<code>SYN</code>后就下线，于是服务器默认等63s才会断开连接，这样攻击者重复这个过程就可以把服务器<code>SYN连接队列</code>耗尽，让正常的连接请求不能处理。于是，<code>Linux</code>下给了一个叫<code>tcp_syncookies</code>的参数来应对这个事——当<code>SYN连接队列</code>满了以后，<code>TCP</code>会通过源地址端口、目标地址端口和时间戳打造出一个特别的<code>Sequence Number</code>发回去(又叫<code>cookie</code>)，如果是攻击者则不会有响应，如果是正常连接，则会把这个<code>SYN cookie</code>发回来，然后服务端可以通过<code>cookie</code>来建连接(即使你不在<code>SYN队列中</code>)，请注意<strong>请先千万别用<code>tcp_syncookies</code>来处理正常的大负载连接的情况</strong>。因为<code>syncookies</code>是妥协版的<code>TCP</code>协议，并不严谨。对于正常的请求有三个参数可供调整，第一个是：<code>tcp_synack_retries</code>可以减少重试次数；第二个是：<code>tcp_max_syn_backlog</code>，可以增大<code>SYN</code>连接数；第三个是：<code>tcp_abort_on_overflow</code> 处理不过来就直接拒绝连接。</p>
</li>
<li><p><strong>关于<code>ISN</code>的初始化</strong> <code>ISN</code>是不能用<code>hard code</code>的，不然会有问题——如果连接建立好始终使用<code>1</code>来作<code>ISN</code>,<code>client</code>发了<code>30</code>个<code>segment</code>过去，但是网络断了，于是<code>client</code>重连，又用<code>1</code>做<code>ISN</code>，但是之前连接的那些包到了，于是就被当成了新连接的包，此时，<code>client</code>的<code>Sequence Number</code>可能是<code>3</code>，而<code>server</code>端认为<code>client</code>的这个号是30了。全乱了。<a href="http://tools.ietf.org/html/rfc793" target="_blank" rel="noopener">RFC793</a>中说，<code>ISN</code>会和一个假的时钟绑在一起，这个时钟会在每<code>4微秒</code>对<code>ISN</code>做加一操作，知道超过<code>2^32</code>，又从<code>0</code>开始。这样，一个<code>ISN</code>的周期大约是<code>4.55个小时</code>。因为，我们假设我们的<code>TCP segment</code>在网络上的存货时间不会超过<code>Maximun Segment Lifetime</code>(MSL)，所以，只要<code>MSL</code>的值小于<code>4.55小时</code>，那么我们就不会重用到<code>ISN</code></p>
</li>
<li><p><strong>关于<code>MSL</code>和<code>TIME_WAIT</code></strong> 在<code>TCP</code>的状态图中，从<code>TIME_WAIT</code>状态到<code>CLOSED</code>状态，有一个超时设置是<code>2*MSL</code>(RFC793定义<code>MSL</code>为<code>分钟</code>,<code>Linux</code>设置为<code>30s</code>)，为什么要有<code>TIME_WAIT</code>，不直接转成<code>CLOSED</code>状体呢？主要有两个原因：1) <code>TIME_WAIT</code>确保有足够的时机让对方收到<code>ACK</code>，如果被动关闭的那方没有收到<code>ACK</code>，就会触发被动端重发<code>FIN</code>，一来一去正好<code>2个MSL</code>  2) 有足够的时间让这个连接不会跟后面的连接混在一起（你要知道，有些路由器会缓存<code>IP数据包</code>，如果连接被重用了，那么这些延迟收到的包就有可能会跟新连接混在一起）</p>
</li>
<li><p><strong>关于<code>TIME_WAIT</code>数量太多</strong> 从上面的描述我们可以知道，<code>TIME_WAIT</code>是一个很重要的状态，但是如果在大并发的短链接下，<code>TIME_WAIT</code>就会太多，这也会消耗很多系统资源。只要搜一下，就会发现多数方式会教你设置两个参数，一个<code>tcp_tw_reuse</code>，另一叫<code>tcp_tw_recycle</code>，这两个参数默认是关闭的后者<code>recycle</code>比前者更激进，<code>reuse</code>要温柔一些。另外，如果使用<code>tcp_tw_reuse</code>，必须设置<code>tcp_timestamps=1</code>，否则无效。这里，你一定要注意，<strong>打开这两个参数会有比较大的坑——可能会让<code>TCP</code>连接出一些诡异的问题</strong></p>
<ul>
<li>关于<code>tcp_tw_reuse</code> 官方文档上说<code>tcp_tw_reuse</code>加上<code>tcp_timestamps</code>可以保证协议角度上的安全，但是你需要<code>tcp_timestamps</code>在两端都被打开</li>
<li>关于<code>tcp_tw_recycle</code> 如果<code>tcp_tw_recycle</code>打开的话，会假设对端开启了<code>tcp_timestamps</code>，然后回去比较时间戳，如果时间戳变大，就可以重用。但是，如果对端是一个<code>NAT</code>网络的话（如：一个公司只用一个IP出公网）或是对端的<code>IP</code>被另一台重用了，这个事就复杂了。建链接的<code>SYN</code>可能被直接丢掉（你可以看到<code>connnection time out</code>的错误）</li>
<li>关于<code>tcp_max_tw_buckets</code> 这个是控制并发<code>TIME_WAIT</code>的数量，默认值是<code>180000</code>，如果超限，那么系统会把多的destory掉，然后在日志里打上警告（如：<code>time wait bucket table overflow</code>），官网文档说这个参数用来对抗<code>DDOS</code>攻击的。也说的<code>180000</code>默认值并不小。这个还要根据实际的情况考虑。</li>
</ul>
</li>
</ul>
<p><code>TIME_WAIT</code>意味是你主动断开连接的，如果对方断连接，那么这个破问题就是对方的了。另外如果你的服务器是<code>HTTP</code>服务器，那么设置一个<code>HTTP的KeepAlive</code>相当重要（浏览器会重用一个<code>TCP</code>连接处理多个<code>HTTP</code>请求），让客户端去断链接。</p>
<h4 id="数据传输中的-Sequence-Number"><a href="#数据传输中的-Sequence-Number" class="headerlink" title="数据传输中的 Sequence Number"></a>数据传输中的 Sequence Number</h4><p>参考自：<a href="http://coolshell.cn/articles/11564.html" target="_blank" rel="noopener">TCP 的那些事儿</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ouronghui.com/2018/07/22/大白话简记TCP/" data-id="cjoqlefi3005lvyrj5cv57s8n" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TCP/">TCP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/协议/">协议</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-再理一遍OAuth2.0" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/22/再理一遍OAuth2.0/" class="article-date">
  <time datetime="2018-07-22T06:09:34.366Z" itemprop="datePublished">2018-07-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/WEB/">WEB</a>►<a class="article-category-link" href="/categories/WEB/安全/">安全</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/22/再理一遍OAuth2.0/">再理一遍OAuth2.0</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>OAuth在我印象中已经啃过几次了。大多数时候，好记性还是不如烂笔头，对自己的记忆力太过自信了，当时理解了，觉的妙，但是现在只记得一个妙字了，至于其它的已经忘的差不多了…</p>
<p>所以最好趁自己刚理解的那一刻，赶紧的尽量用自己组织的语言记录下来。</p>
<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>首先，想到<code>OAuth 2.0</code>，脑海中先弹出<strong>三方交互</strong>的概念，三方即如下：</p>
<ul>
<li><strong>资源提供者</strong></li>
<li><strong>用户(资源拥有者)</strong></li>
<li><strong>获取资源者</strong></li>
</ul>
<p>在来挨个解释下，<strong>资源提供者</strong>，好比新浪微博提供了发微博、获取微博列表，百度网盘提供了存储文件、访问文件列表的服务，其中新浪微博、百度网盘都是资源的提供者。<strong>用户</strong>就是资源拥有者，具体的某条微博、网盘里的某个照片都是具体用户的，没有得到用户允许，资源提供者不可供其他应用使用。<strong>获取资源者</strong> 就是一些非资源提供者的应用想要访问这些资源，比如一款冲印照片的应用需要访问你网盘里的照片。</p>
<p><code>资源提供者</code>、<code>获取资源者</code>、<code>用户(资源拥有者)</code>，为了引用方便，我们先将分别简称其为：<code>B1</code>、<code>B2</code>、<code>C</code>。站在<code>B1</code>的角度来说，它定义了OAuth服务，交互细节都有它来设计，整个流程都需要依赖它，其一般是拥有众多用户的高可用服务。对于<code>B2</code>来说，它“觊觎”<code>B1</code>庞大的用户群以及用户资源(为用户省心，避免再注册于在上传资源)，它的最终目的是通过<code>Access Token</code>拿到想要的资源。对于<code>C</code>来说，它其实既是<code>B1</code>的用户，也是<code>B2</code>的用户，<code>C</code>在整个过程中只需要选中同意还是不同意。</p>
<p>搞清楚了这些概念后，如果你要做应用，最好确定下你是要做<strong>提供者的应用</strong> 还是<strong>获取者的应用</strong>，前者相当于是要在基于现有服务，整理好资源提供一整套<code>OAuth 2.0</code>的Server，后者作为一个<code>OAuth 2.0</code>的Client相对较为简单。</p>
<h2 id="软件架构概念"><a href="#软件架构概念" class="headerlink" title="软件架构概念"></a>软件架构概念</h2><p>有了以上的概念我们就能从宏观上来理解为什么会有OAht2.0的存在。如果要从软件上来实现它，基于以上三者，我们还需要细分一下，如下：</p>
<ul>
<li>资源提供者<ul>
<li><strong>HTTP service</strong>: HTTP服务提供商</li>
<li><strong>Resource Server</strong>: 资源服务器，可能你需要整理归类下现有的资源，有的资源可能不需要列入资源服务器。比如<a href="http://open.weibo.com/apps/4307576/privilege" target="_blank" rel="noopener">新浪微博的接口分组</a></li>
<li><strong>Authorization server</strong>: 认证服务，提供资源的授权服务</li>
</ul>
</li>
<li>用户(资源拥有者)<ul>
<li><strong>Resource Owner</strong>: 资源拥拥有者，用户</li>
<li><strong>User Agent</strong>: 用户代理，这个就代表着用户，一般就是浏览器、操作界面。</li>
</ul>
</li>
<li>获取资源者<ul>
<li><strong>Third-part application</strong>： 第三方应用程序</li>
</ul>
</li>
</ul>
<h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><ul>
<li>作为第三方应用，避免注册环节，用微博、微信、QQ等登录/注册</li>
<li>作为三方应用，访问用户的资源，比如分享微博，打印网盘照片等</li>
</ul>
<h2 id="运行流程"><a href="#运行流程" class="headerlink" title="运行流程"></a>运行流程</h2><p><code>OAuth 2.0</code>的运行流程如下：(referrence from <a href="https://www.rfc-editor.org/rfc/rfc6749.txt" target="_blank" rel="noopener">RFC-6749</a>)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">+--------+                               +---------------+</span><br><span class="line">|        |--(A)- Authorization Request -&gt;|   Resource    |</span><br><span class="line">|        |                               |     Owner     |</span><br><span class="line">|        |&lt;-(B)-- Authorization Grant ---|               </span><br><span class="line">|        |                               +---------------+</span><br><span class="line">|        |</span><br><span class="line">|        |                               +---------------+</span><br><span class="line">|        |--(C)-- Authorization Grant --&gt;| Authorization |</span><br><span class="line">| Client |                               |     Server    |</span><br><span class="line">|        |&lt;-(D)----- Access Token -------|               |</span><br><span class="line">|        |                               +---------------+</span><br><span class="line">|        |</span><br><span class="line">|        |                               +---------------+</span><br><span class="line">|        |--(E)----- Access Token ------&gt;|    Resource   </span><br><span class="line">|        |                               |     Server    |</span><br><span class="line">|        |&lt;-(F)--- Protected Resource ---|               |</span><br><span class="line">+--------+                               +---------------+</span><br></pre></td></tr></table></figure></p>
<p>步骤如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(A) 用户打开客户端后，客户端要求用户授权</span><br><span class="line">(B) 用户同意给予客户端授权</span><br><span class="line">(C) 客户端使用上一步获得的授权，向认证服务器申请令牌。</span><br><span class="line">(D) 认证服务器对客户端进行认证后，确认无误，同意发放令牌</span><br><span class="line">(E) 客户端使用令牌，向资源服务器申请获取资源</span><br><span class="line">(F) 资源服务器确认令牌无误，同意向客户端开放资源</span><br></pre></td></tr></table></figure></p>
<p>简单的来分析下，上面的流程是以请求为载体流转的，最终拿到Access token需要经过几个步骤，但是拿到的Access Token在失效前一直可以重复使用，也就是后面对资源的请求都是请求-应答这种方式。得到Access Token前花费两次“请求-响应”，一次是询问用户是否授权，另外一次是根据授权码请求得到Access Token。这一点与我们平时的普通web应用不同，平时web的认证只需要一次登录“请求-响应”，一般请求携带着用户名、密码，响应头里设置客户端sessionid至cookie。为什么前者需要两次，而后者只需要一次呢？因为后者服务端只需要验证用户名密码是否正确，而前者则需要转个弯，三方应用先向用户申请，申请同意过后再向资源提供的应用申请。</p>
<h2 id="授权模式"><a href="#授权模式" class="headerlink" title="授权模式"></a>授权模式</h2><p>前面讲到三方应用要向用户申请授权，这个过程要怎么做才合适呢？很显然这个<strong>授权的界面</strong>不能由第三来做，不然就没一点意义了，这个授权的界面都是资源提供方来做的，一般在界面还会提示一些文字让用户确认该界面是资源官方提供的，比如新浪微博:<br><img src="http://wx4.sinaimg.cn/mw690/929194b4gy1fh6smtxhlsj20h00980t5.jpg" alt=""><br>这个提醒大多数普通用户是忽略的，因为现在也很少有黑客用这种方式用来盗取微博的密码了，不过这种方式在仿银行的网站上存在很多。</p>
<p>客户端必须得到用户的授权（authorization grant），才能获取令牌（Access Token），OAuth2.0定义了四种授权方式。</p>
<ul>
<li>授权码模式 （authorization code）</li>
<li>简化模式 （implicit）</li>
<li>密码模式 （resource owner password credentials）</li>
<li>客户端模式 （client credentials）</li>
</ul>
<h2 id="授权码模式"><a href="#授权码模式" class="headerlink" title="授权码模式"></a>授权码模式</h2><p>授权码模式（authorization code）是功能最完整、流程最严密的授权模式。它的特点是通过客户端的后台服务器，与“服务提供商”的认证服务器进行互动。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">+----------+</span><br><span class="line">| Resource |</span><br><span class="line">|   Owner  |</span><br><span class="line">|          |</span><br><span class="line">+----------+</span><br><span class="line">     ^</span><br><span class="line">     |</span><br><span class="line">    (B)</span><br><span class="line">+----|-----+          Client Identifier      +---------------+</span><br><span class="line">|         -+----(A)-- &amp; Redirection URI ----&gt;|               |</span><br><span class="line">|  User-   |                                 | Authorization |</span><br><span class="line">|  Agent  -+----(B)-- User authenticates ---&gt;|     Server    |</span><br><span class="line">|          |                                 |               |</span><br><span class="line">|         -+----(C)-- Authorization Code ---&lt;|               |</span><br><span class="line">+-|----|---+                                 +---------------+</span><br><span class="line">  |    |                                         ^      v</span><br><span class="line"> (A)  (C)                                        |      |</span><br><span class="line">  |    |                                         |      |</span><br><span class="line">  ^    v                                         |      |</span><br><span class="line">+---------+                                      |      |</span><br><span class="line">|         |&gt;---(D)-- Authorization Code ---------&apos;      |</span><br><span class="line">|  Client |          &amp; Redirection URI                  |</span><br><span class="line">|         |                                             |</span><br><span class="line">|         |&lt;---(E)----- Access Token -------------------&apos;</span><br><span class="line">+---------+       (w/ Optional Refresh Token)</span><br></pre></td></tr></table></figure></p>
<p>执行步骤：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 用户访问客户端，后者将其导向认证服务器 ----------------- 比如打开：https://passport.csdn.net/ ，点击“微博登录”，其链接导向的是：https://api.weibo.com/oauth2/authorize?client_id=2601122390&amp;response_type=code&amp;redirect_uri=https%3A%2F%2Fpassport.csdn.net%2Faccount%2Flogin%3Foauth_provider%3DSinaWeiboProvider</span><br><span class="line">2. 用户选择是否给客户端授权</span><br><span class="line">3. 假设用户选择了授权，认证服务器将用户导向至客户端事先指定的“重定向URI”（redirect URI），同时在URI后会附上一个授权码-----------------比如前面的新浪：点击授权，请求api.weibo/oauth2/autorize，响应“302”（重定向），响应头中的Location=https://passport.csdn.net/account/login?oauth_provider=SinaWeiboProvider&amp;code=fbfd1c75c3309bb653a7c0816f919f49 ，即重定向地址。</span><br><span class="line">4. 客户端根据“附带了授权码code的重定向URI”请求，即重定向的实现，客户端的后台服务器上向认证服务器申请令牌-token，这个请求-响应对于客户端与用户是不可见的</span><br><span class="line">5. 认证服务器对授权码和重定向URI确认无误后，向客户端发送访问令牌（access token）和更新令牌（refresh token）</span><br></pre></td></tr></table></figure></p>
<p>看下上面的一些请求细节。<br>第一步，客户端导向认证服务器的URI的参数：</p>
<ul>
<li>clietn_id: 客户端ID，这个一般是三方应用向OAuth服务提供者申请得到的，签发后一般是固定不变的。</li>
<li>response_type: 授权类型，必选项，此处固定值为code。</li>
<li>redirect_uri: 表示重定向URI，可选项。</li>
<li>scope: 申请的权限范围，可选项。</li>
<li>state: 表示客户端当前状态，自定义之，认证服务器会原封不动的返回这个值。</li>
</ul>
<p>第二步，授权界面：</p>
<ul>
<li>用户如果在资源提供方还未进行过认证(登录)，那么需要用户先登录认证，会有用户名、密码等登录表单，登录通过后再是授权界面</li>
</ul>
<p>第三步，授权与否：</p>
<ul>
<li>前面的步骤的假设是，用户选择了授权，界面上有时会有“取消”按钮，当用户拒绝授权时也可以通过URI重定向通知到客户端用户的行为</li>
</ul>
<p>第四步，带授权码的URI重定向跳转，客户端的后台服务向认证服务器申请token</p>
<ul>
<li>授权码code，为了安全一般具有时效性，通常是10分钟，且使用一次后失效。该code与client_id是一一对应关系，即其他应用使用这个code是无效的，另外重定向的URI也是与之对应相对固定的。</li>
<li>申请token的参数：（地址类似：POST //github.com/login/oauth/access_token）<ul>
<li>grant_type：表示授权模式，必选项，此处为“authorization_code” （与之相呼应的是第一步请求里的 response_type=code）</li>
<li>code：表示上一步获得的授权码，必选项</li>
<li>redirect_uri：表示重定向URI，必选项，与第一步请求里的redirect_uri保持一致</li>
<li>client_id：表示客户端ID，必选项</li>
<li>client_secret：三方应用与OAuth服务商协商所得，注意保密，不要放置到客户端。（为什么不用上面的用户授权码code直接作为access token的原因其实也就在这里）</li>
</ul>
</li>
</ul>
<p>第五步，认证服务器检查token请求，响应参数如下：</p>
<ul>
<li>access_token：表示访问令牌</li>
<li>token_type：表示令牌类型，可以是bearer或mac类型</li>
<li>expires_in：表示过期时间，单位为秒。如果省略该参数，必须在其他地方设置过期时间</li>
<li>refresh_token：表示更新令牌，用来获取下一次的访问令牌，可选项。</li>
<li>scope：表示授权范围，如果与客户端申请的范围一致，可省略。</li>
</ul>
<h2 id="其他三种授权模式"><a href="#其他三种授权模式" class="headerlink" title="其他三种授权模式"></a>其他三种授权模式</h2><p>关于这三种模式，这里只会简单的记录下，如果需要详细了解，可以点文章末尾的链接去看阮一峰的文章。</p>
<ul>
<li>简化模式（implicit grant type）<ul>
<li>其特点是<strong>跳过了授权码</strong>这个步骤，所有步骤在浏览器中完成。 ——<a href="https://segmentfault.com/q/1010000008974042" target="_blank" rel="noopener">疑问</a></li>
</ul>
</li>
<li>密码模式（Resource Owner Password Credentials Grant）<ul>
<li>用户向客户端提供用户名、密码</li>
<li>客户端使用用户提交的信息，提交给认证服务器申请令牌 <strong>通常这个客户端必须是高度可信任的</strong>，不然会有泄密的可能。</li>
</ul>
</li>
<li>客户端模式（Client Credentials Grant）<ul>
<li>客户端使用自己的名义，而不是用户的名义，向认证服务器认证。其实整个过程不存在授权，只有一个认证，就是服务器认证客户端是可信客户端。</li>
</ul>
</li>
</ul>
<h2 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h2><p><a href="http://jinnianshilongnian.iteye.com/blog/2038646" target="_blank" rel="noopener">OAuth2集成——《跟我学Shiro》</a></p>
<h2 id="关于安全"><a href="#关于安全" class="headerlink" title="关于安全"></a>关于安全</h2><p>从以上的实现机制，可以看出最终是为了得到<code>token</code>。其实这个<code>token</code>与平时web会话客户端的那个 <code>sessionid</code>的本质意义是一样的，都是用户的身份标识。<br>为了<code>sessionid</code>的安全我们一般会做两点，后台设置的response cookie是<code>httpOnly</code>的，也就是js不可读取保证客户端安全，另外就是使用<code>https</code>保证传输通道的安全。按照这个思路我们可以类比下这个<code>token</code>该怎么在安全方面有所保障。</p>
<ul>
<li>尽量保证token 不能被三方代码访问</li>
<li>请求token IP的白名单</li>
</ul>
<p>安全问题，需要好好权衡，“三道安全门”你自己进门都会很困难，“一道安全门”足已，重要的是你要保护好自己的钥匙，插在门上不拔，再多安全门也没用。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>细节总难被记住，单个的web项目的身份认证只需要一个登录请求即可，而OAuth2.0涉及的是三方，会有两次请求，记忆的转弯点在这里，所以我的总结就是<strong>请求授权码，请求token</strong>。</p>
<hr>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="http://www.barretlee.com/blog/2016/01/10/oauth2-introduce/" target="_blank" rel="noopener">小胡子哥——简述 OAuth 2.0 的运作流程</a></li>
<li><a href="https://www.zhihu.com/question/20274730" target="_blank" rel="noopener">知乎——Oauth的access token 安全么?</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html" target="_blank" rel="noopener">阮一峰——理解OAuth 2.0</a></li>
<li><a href="http://www.zhenchao.org/categories/protocol/" target="_blank" rel="noopener">小米-振超——指间生活——token类型、协议等</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ouronghui.com/2018/07/22/再理一遍OAuth2.0/" data-id="cjoqlefht005avyrjq94ojzda" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/安全/">安全</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/授权/">授权</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/22/hello-world/" class="article-date">
  <time datetime="2018-07-22T05:38:51.936Z" itemprop="datePublished">2018-07-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/22/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ouronghui.com/2018/07/22/hello-world/" data-id="cjoqlefgu0043vyrjv8i1t4hs" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-搭建-ELK-日志中心" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/03/01/搭建-ELK-日志中心/" class="article-date">
  <time datetime="2018-03-01T00:47:40.000Z" itemprop="datePublished">2018-03-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/03/01/搭建-ELK-日志中心/">搭建 ELK 日志中心</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ouronghui.com/2018/03/01/搭建-ELK-日志中心/" data-id="cjoqlefia005zvyrjaoc0yefz" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Spring-生命周期" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/02/22/Spring-生命周期/" class="article-date">
  <time datetime="2018-02-22T01:25:00.000Z" itemprop="datePublished">2018-02-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/02/22/Spring-生命周期/">Spring 生命周期</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="http://wx4.sinaimg.cn/large/929194b4gy1fooy17jd8aj21kw0qnteq.jpg" alt="Spring Bean 初始化时序图"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ouronghui.com/2018/02/22/Spring-生命周期/" data-id="cjoqlefgj003lvyrjbovx8ars" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-n2n点对点通信" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/01/04/n2n点对点通信/" class="article-date">
  <time datetime="2018-01-04T03:23:12.000Z" itemprop="datePublished">2018-01-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/04/n2n点对点通信/">n2n点对点通信</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="N2N介绍"><a href="#N2N介绍" class="headerlink" title="N2N介绍"></a>N2N介绍</h4><p>通过N2N即可组成局域网，在外面可以访问家里的路由器、机器。</p>
<ul>
<li>Supernode 中心节点，并不参与两台主机间直接通信, 只是起到媒人的作用。</li>
<li>Edge 节点都会建立tun/tap虚拟网卡，用作n2n网络的入口，Edge节点就可以互通了。</li>
</ul>
<h4 id="V1-与-V2"><a href="#V1-与-V2" class="headerlink" title="V1 与 V2"></a>V1 与 V2</h4><p>n2n有V1和V2两个版本， 两个版本不兼容，据说V1的性能还略高于V2,V2是增加了一些安全相关的提升。</p>
<p>所以我这里都是<strong>基于V1版本</strong>搭建的。</p>
<h4 id="Linux-Supernode-的安装"><a href="#Linux-Supernode-的安装" class="headerlink" title="Linux Supernode 的安装"></a>Linux Supernode 的安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/meyerd/n2n</span><br><span class="line">$ <span class="built_in">cd</span> n2n/n2n_v1</span><br><span class="line">$ make</span><br><span class="line">$ make install 2&gt;&amp;1 | tee  make.log</span><br></pre></td></tr></table></figure>
<p>启动：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ nohup supernode -l 86 -v -f &gt; supernode.log &amp;</span><br></pre></td></tr></table></figure>
<p>#### </p>
<h4 id="Ubuntu-Edge-的安装"><a href="#Ubuntu-Edge-的安装" class="headerlink" title="Ubuntu Edge 的安装"></a>Ubuntu Edge 的安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/meyerd/n2n</span><br><span class="line">$ <span class="built_in">cd</span> n2n/n2n_v1</span><br><span class="line">$ make</span><br><span class="line">$ sudo make install</span><br><span class="line">$ sudo su</span><br><span class="line">$ apt install uml-utilities</span><br><span class="line">$ tunctl -t tun0</span><br><span class="line">$ sudo edge -d n2n0 -c orh -k 123 -m c2:27:ad:05:b3:a5 -a 10.8.1.7 -l 104.128.82.194:86 -r -f</span><br></pre></td></tr></table></figure>
<h4 id="Openwrt-Edge的安装"><a href="#Openwrt-Edge的安装" class="headerlink" title="Openwrt  Edge的安装"></a>Openwrt  Edge的安装</h4><p>这里我是在虚拟机中安装的<code>Openwrt</code>可以先下载虚拟机文件，虚拟机</p>
<p><code>http://downloads.openwrt.org/attitude_adjustment/12.09/x86/generic/openwrt-x86-generic-combined-ext4.vdi</code></p>
<p>安装与配置：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ opkg update</span><br><span class="line">$ opkg install n2n</span><br><span class="line">$ </span><br><span class="line">$ vim /etc/config/n2n</span><br><span class="line">$ option ipaddr           <span class="string">'10.2.5.1'</span></span><br><span class="line">$ option supernode        <span class="string">'104.128.82.194'</span></span><br><span class="line">$ option port             <span class="string">'86'</span></span><br><span class="line">$ <span class="comment"># 为自己的N2N网络组织机构取个名字</span></span><br><span class="line">$ option community        <span class="string">'orh'</span></span><br><span class="line">$ <span class="comment"># 其他设备要使用相同的组织机构名和密码才能加入</span></span><br><span class="line">$ option key              <span class="string">'123'</span></span><br><span class="line">$ option route            <span class="string">'1'</span></span><br></pre></td></tr></table></figure>
<p>启用，启动、停止：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/n2n <span class="built_in">enable</span></span><br><span class="line">/etc/init.d/n2n start</span><br><span class="line">/etc/init.d/n2n stop</span><br></pre></td></tr></table></figure>
<p>参考文章：</p>
<ul>
<li><a href="http://gohom.win/2016/09/03/n2n-p2pnet/" target="_blank" rel="noopener">P2P网络-n2n穿墙</a></li>
<li><a href="https://wiki.openwrt.org/zh-cn/doc/techref/opkg" target="_blank" rel="noopener">OPKG包管理</a></li>
<li><a href="http://openwrt.jaru.eu.org/chaos_calmer/ar71xx/packages/" target="_blank" rel="noopener">Openwrt离线包</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ouronghui.com/2018/01/04/n2n点对点通信/" data-id="cjoqlefh9004lvyrju5kkrkta" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/n2n/">n2n</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/HTTP/">HTTP</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/HTTP/通信/">通信</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/数据库/">数据库</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/数据库/PostgreSQL/">PostgreSQL</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nginx/">Nginx</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Nginx/Lua/">Lua</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nginx/Openresty/">Openresty</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/PostgreSQL/">PostgreSQL</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/PostgreSQL/数据库/">数据库</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/WEB/">WEB</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/WEB/安全/">安全</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript语言/">javascript语言</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据结构/">数据结构</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/英语/">英语</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/计划/">计划</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机基础/">计算机基础</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AMD/">AMD</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CMD/">CMD</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Centos软件安装/">Centos软件安装</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CommonJS/">CommonJS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/">Nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PostgreSQL基础/">PostgreSQL基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TCP/">TCP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cassandra/">cassandra</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript函数/">javascript函数</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript基础/">javascript基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/n2n/">n2n</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/健身/">健身</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/协议/">协议</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/多线程/">多线程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/多线程-锁/">多线程 锁</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/安全/">安全</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/意志/">意志</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/授权/">授权</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/服务/">服务</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/模块化/">模块化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/源码/">源码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/源码阅读/">源码阅读</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/灰度发布/">灰度发布</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/版本控制/">版本控制</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/编码/">编码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/编程/">编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/英语/">英语</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/计划/">计划</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/运动/">运动</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/进程/">进程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/阅读/">阅读</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/AMD/" style="font-size: 10px;">AMD</a> <a href="/tags/CMD/" style="font-size: 10px;">CMD</a> <a href="/tags/Centos软件安装/" style="font-size: 15px;">Centos软件安装</a> <a href="/tags/CommonJS/" style="font-size: 10px;">CommonJS</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/Nginx/" style="font-size: 10px;">Nginx</a> <a href="/tags/PostgreSQL基础/" style="font-size: 15px;">PostgreSQL基础</a> <a href="/tags/TCP/" style="font-size: 10px;">TCP</a> <a href="/tags/cassandra/" style="font-size: 10px;">cassandra</a> <a href="/tags/javascript/" style="font-size: 10px;">javascript</a> <a href="/tags/javascript函数/" style="font-size: 15px;">javascript函数</a> <a href="/tags/javascript基础/" style="font-size: 15px;">javascript基础</a> <a href="/tags/n2n/" style="font-size: 10px;">n2n</a> <a href="/tags/vim/" style="font-size: 10px;">vim</a> <a href="/tags/健身/" style="font-size: 10px;">健身</a> <a href="/tags/协议/" style="font-size: 10px;">协议</a> <a href="/tags/多线程/" style="font-size: 20px;">多线程</a> <a href="/tags/多线程-锁/" style="font-size: 10px;">多线程 锁</a> <a href="/tags/安全/" style="font-size: 10px;">安全</a> <a href="/tags/意志/" style="font-size: 10px;">意志</a> <a href="/tags/授权/" style="font-size: 10px;">授权</a> <a href="/tags/服务/" style="font-size: 10px;">服务</a> <a href="/tags/模块化/" style="font-size: 10px;">模块化</a> <a href="/tags/源码/" style="font-size: 10px;">源码</a> <a href="/tags/源码阅读/" style="font-size: 10px;">源码阅读</a> <a href="/tags/灰度发布/" style="font-size: 10px;">灰度发布</a> <a href="/tags/版本控制/" style="font-size: 10px;">版本控制</a> <a href="/tags/编码/" style="font-size: 15px;">编码</a> <a href="/tags/编程/" style="font-size: 10px;">编程</a> <a href="/tags/英语/" style="font-size: 10px;">英语</a> <a href="/tags/计划/" style="font-size: 10px;">计划</a> <a href="/tags/运动/" style="font-size: 10px;">运动</a> <a href="/tags/进程/" style="font-size: 10px;">进程</a> <a href="/tags/阅读/" style="font-size: 10px;">阅读</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/08/31/Cassandra-数据库使用小记/">Cassandra 数据库使用小记</a>
          </li>
        
          <li>
            <a href="/2018/08/22/Supervisor的使用/">Supervisor的使用</a>
          </li>
        
          <li>
            <a href="/2018/08/09/Lua-OpenResty-开发环境搭建/">Lua OpenResty 开发环境搭建</a>
          </li>
        
          <li>
            <a href="/2018/08/05/Nginx-Lua-实现灰度发布/">Nginx+Lua 实现灰度发布</a>
          </li>
        
          <li>
            <a href="/2018/07/22/大白话简记TCP/">大白话简记TCP</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 orh<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>